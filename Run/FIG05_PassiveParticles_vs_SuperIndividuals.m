close all
clear all
warning off
%==========================================================================

%==========================================================================
%% Script to plot the comparison between passive and super-individuals
% Lagrangian particles
%--------------------------------------------------------------------------
% Writen by Iria Sala
% Created on 09.02.2023
% Edited by Bingzhang Chen (bingzhang.chen@strath.ac.uk) on 28.04.2025
%==========================================================================

%==========================================================================
%% Load Kv field to estimate the Mixed Layer Depth (MLD, m):
%==========================================================================
%..........................................................................
EUL = 'Euler.nc';
%..........................................................................
Z_w = double(ncread(EUL,'Z_w')); % Depth (m)
Kv  = double(ncread(EUL,'Kv'));  % Vertical diffusivity (Kv, m2 s-1)
%..........................................................................
DMLD = 1:365; % Time vector (day)
%..........................................................................
% Find the closest values to 10-4 to define the MLD:
val = 1e-4;
%..........................................................................
for d = 1:365
    
    prof = Kv(:,d);
    [nu,ix] = min(abs(prof-val));

    zdep = Z_w(ix);

    MLD(d,:) = zdep;

end
%==========================================================================

%==========================================================================
%% Load Lagrangian fields:
%==========================================================================
LAG = 'ParY6.nc'; %Download from https://strath-my.sharepoint.com/:u:/g/personal/bingzhang_chen_strath_ac_uk/EWzT89WKyYxOg_vAfbnhuzsBGCK371cdqmuk3Zik4-boUQ?e=e6Lb1P
%..........................................................................
DAYS  = double(ncread(LAG,'DOY'))'; % Time (hours)
tPART = DAYS;
%..........................................................................
zPART  = double(ncread(LAG,'Z'))';   % Super-individuals depth position
%==========================================================================

%==========================================================================
%% Load Pasive particles fields:
%==========================================================================
PAS = 'PassY6.nc'; %Download from https://strath-my.sharepoint.com/:u:/g/personal/bingzhang_chen_strath_ac_uk/EUeaWW_WmypMrFoiK5W34tMBVD6wxhtOGFIB6BvpEy94jw?e=Cq4IUb
%..........................................................................
DAYS  = double(ncread(PAS,'DOY'))'; % Time (days)
tPASS = DAYS;
%..........................................................................
zPASS = double(ncread(PAS,'Z'))';   % Passive particle depth position
%==========================================================================

%==========================================================================
%% Depth ranges for plot reasons:
%==========================================================================
Z_w = -250:5.0:0;   % Grid limits
Z_r = -245:2.5:0;   
Z_r = Z_r(1:2:end); % Intermediate depth
%==========================================================================

%==========================================================================
%% Time interval, mean values every 5 days:
%==========================================================================
D05 = 1:5*24:8737;
%==========================================================================

%==========================================================================
%% Reorganize data and compute mean values every 5 days and every 5 m:
%==========================================================================
for j = 1:length(D05)-1
    
    zSI = zPART(D05(j):D05(j)+4,:);
    zPP = zPASS(D05(j):D05(j)+4,:);
    
    % Select super-individuals by depth level:
    for i = 1:length(Z_w)-1

        sSI = find(zSI>=Z_w(i) & zSI<=Z_w(i+1));
        sPP = find(zPP>=Z_w(i) & zPP<=Z_w(i+1));

        SIndz = numel(sSI);
        SParz = numel(sPP);

        sindz(:,i) = SIndz;
        sparz(:,i) = SParz;

    end
    
    %======================================================================
    % Output matrix with the total number of super-individuals:
    tSInd(j,:) = sindz;
    tSPar(j,:) = sparz;
    %======================================================================
    
end
%==========================================================================

%==========================================================================
%% Calculate particle proportion, for better comparison:
%==========================================================================
tSInd = tSInd / (size(zPART,1) * 5);
tSPar = tSPar / (size(zPASS,1) * 5);
%==========================================================================

%==========================================================================
%% Time vectors for plotting:
%==========================================================================
Tvec = [1 32 60 91 121 152 182 213 244 274 305 335];
Tout = {'J' 'F' 'M' 'A' 'M' 'J' 'J' 'A' 'S' 'O' 'N' 'D'};
%==========================================================================


%==========================================================================
%% FIGURE
%==========================================================================
make_it_tight = true;
% m = distance between subplots
% n = distance to bottom and top
% p = distance to left and right
subplot = @(m,n,p) subtightplot (m, n, p, [0.01 0.01], [0.14 0.10], [0.08 0.04]);
if ~make_it_tight,  clear subplot;  end
%..........................................................................
Fig = figure;
set(gcf, 'Color','white');
set(Fig, 'Position',[400,200,1000,400]);
%==========================================================================
F01 = subplot(1,2,1);
hold on
box on
%..........................................................................
pcolor(tPART(1,D05(1:72)),Z_r,tSPar');
%..........................................................................
plot(DMLD,MLD,'Color','w','LineWidth',1);
%..........................................................................
xlim([1 365]);
xlabel('Time (months)','FontSize',11);
set(gca,'XTick',Tvec,'XTickLabel',Tout,'FontSize',11)
%..........................................................................
ylim([-250 -5]);
ylabel('Depth (m)');
set(gca,'YTick',[-250:50:0],'YTickLabel',[-250:50:0],'FontSize',11)
%..........................................................................
title('(a) Passive particles')
%..........................................................................
% colormap(jet);
caxis([0 0.05]);
% h1 = colorbar('EastOutside');
% set(h1,'FontSize',11);
% set(h1, 'Position', [.46 .16 .02 .72]);
% % set(h1,'ytick',[0:0.05:0.2],'yticklabel',[0:0.05:0.2],'FontSize',12)
%..........................................................................
set(gca,'FontSize',11,'FontName','Arial'); 
%==========================================================================
F02 = subplot(1,2,2);
hold on
box on
%..........................................................................
pcolor(tPART(1,D05(1:72)),Z_r,tSInd');
%..........................................................................
plot(DMLD,MLD,'Color','w','LineWidth',1);
%..........................................................................
xlim([1 365]);
xlabel('Time (months)','FontSize',11);
set(gca,'XTick',Tvec,'XTickLabel',Tout,'FontSize',11)
%..........................................................................
ylim([-250 -5]);
% ylabel('Depth (m)');
set(gca,'YTick',[-250:50:0],'YTickLabel',[],'FontSize',11)
%..........................................................................
title('(b) Super-individuals')
%..........................................................................
colormap(jet);
caxis([0 0.05]);
h2 = colorbar('EastOutside');
set(h2,'FontSize',11);
set(h2, 'Position', [.93 .16 .02 .72]);
set(h2,'FontSize',12)
% set(h2,'ytick',[0:0.1:0.5],'yticklabel',[0:0.1:0.5],'FontSize',12)
%..........................................................................
set(gca,'FontSize',11,'FontName','Arial'); 
%==========================================================================
set(F01,'position',[0.08 0.14 0.41 0.75])
set(F02,'position',[0.51 0.14 0.41 0.75])
%==========================================================================
%% Save figure:
%..........................................................................
set(gcf,'PaperPositionMode','auto');
print(gcf, '-dpng', 'FIG05_SupIndvsPasPar.png');
%--------------------------------------------------------------------------
print('FIG05_SupIndvsPasPar', '-depsc'); % Save as an EPS file
%--------------------------------------------------------------------------
% Get the current figure position in inches
fig = gcf;
fig.Units = 'inches';
figPosition = fig.Position;
%..........................................................................
% Set PaperSize to match the figure dimensions
set(gcf, 'PaperUnits', 'inches');
set(gcf, 'PaperSize', [figPosition(3) figPosition(4)]);
%..........................................................................
% Save the figure as a PDF using the print command
exportgraphics(gcf, 'FIG05_SupIndvsPasPar.pdf', 'ContentType', 'vector');
close all;
%==========================================================================
return
