close all
clear all
warning off
%==========================================================================

%==========================================================================
%% Script to plot the model physical forcing
%--------------------------------------------------------------------------
% Writen by Iria Sala
% Created on 29.04.2022
%==========================================================================

%==========================================================================
%% Load hybrid-model Eulerian fields:
%==========================================================================
%..........................................................................
EUL  = 'Euler.nc';
%==========================================================================
Z_r  = double(nc_varget(EUL,'Z_r'));  % Depth (m), intermediate point
Z_w  = double(nc_varget(EUL,'Z_w'));  % Depth (m), limit point
DAY  = double(nc_varget(EUL,'Day'));  % Time (day)
%--------------------------------------------------------------------------
TEMP = double(nc_varget(EUL,'Temp')); % Temperature (decree C)
TEMP = TEMP(367:731,:);               % Last year
%--------------------------------------------------------------------------
PAR  = double(nc_varget(EUL,'PAR'));  % PAR (W m-2)
PAR  = PAR(367:731,:);                % Last year
%--------------------------------------------------------------------------
KPPV  = double(nc_varget(EUL,'Kv'));  % Kv (m2 s-1)
KPPV  = KPPV(367:731,:);              % Last year
%==========================================================================

%==========================================================================
%% Estimate Mixed Layer Depth (MLD) from Kv data:
%==========================================================================
%==========================================================================
%% Mixed layer depth:
%==========================================================================
DMLD = 1:365;
%..........................................................................
% Find the closest values to 10-4 to define the MLD:
val = 10e-4;
%..........................................................................
for d = 1:365
    
    prof = KPPV(d,:);
    [nu,ix] = min(abs(prof-val));

    zdep = Z_w(ix);

    MLD(d,:) = zdep;

end
%==========================================================================

%==========================================================================
%% Plotting grid:
%==========================================================================
TIME  = 1:365;
TIMEr = repmat(TIME',[1,100]); % Time matrix
TIMEk = repmat(TIME',[1,101]); % Time matrix
%..........................................................................
Zr_N = repmat(Z_r',[365,1]);   % Depth matrix
Zw_N = repmat(Z_w',[365,1]);   % Depth matrix
%==========================================================================

%==========================================================================
%% Plot time vectors:
%==========================================================================
Tvec = [1 32 60 91 121 152 182 213 244 274 305 335];       % Time ticks
Tout = {'J' 'F' 'M' 'A' 'M' 'J' 'J' 'A' 'S' 'O' 'N' 'D'};  % Time labels
%==========================================================================


%==========================================================================
%% FIGURE
%==========================================================================
make_it_tight = true;
% m = distance between subplots
% n = distance to bottom and upper edges
% p = distance to right and left edges
subplot = @(m,n,p) subtightplot (m, n, p, [0.08 0.01], [0.10 0.02], [0.05 0.03]);
if ~make_it_tight,  clear subplot;  end
%..........................................................................
Fig = figure;
set(gcf, 'Color','white');
set(Fig, 'Position',[400,100,1200,350]);
%==========================================================================
F01 = subplot(1,3,1);
%..........................................................................
hold on
box on
%..........................................................................
pcolor(TIMEr,Zr_N,TEMP);
shading interp
%..........................................................................
title('(a) Temperature (ÂºC)')
%..........................................................................
xlim([1 365]);
xlabel('Time (months)')
set(gca,'XTick',Tvec,'XTickLabel',Tout,'FontSize',11)
%..........................................................................
ylim([-250 0]);
ylabel('Depth (m)');
set(gca,'YTick',[-250:50:0],'YTickLabel',[-250:50:0],'FontSize',11)
%..........................................................................
colormap(jet);
caxis([18 28]);
h1 = colorbar('EastOutside');
set(h1, 'Position', [.325 .15 .015 .71]);
set(h1,'FontSize',11);
set(h1,'ytick',[18:2:28],'yticklabel',[18:2:28],'FontSize',11)
%..........................................................................
set(gca,'FontSize',11,'FontName','Arial');
%==========================================================================
F02 = subplot(1,3,2);
%..........................................................................
hold on
box on
%..........................................................................
pcolor(TIMEk,Zw_N,log10(KPPV));
shading interp
%..........................................................................
plot(DMLD,MLD,'Color','w','LineWidth',1);
%..........................................................................
title('(b) K_v (m^2 s^{-1})')
%..........................................................................
xlim([1 365]);
xlabel('Time (months)')
set(gca,'XTick',Tvec,'XTickLabel',Tout,'FontSize',11)
%..........................................................................
ylim([-250 0]);
% ylabel('Depth (m)');
set(gca,'YTick',[-250:50:0],'YTickLabel',[],'FontSize',11)
%..........................................................................
colormap(jet);
caxis([log10(0.001) log10(1)]);
h2 = colorbar('EastOutside');
set(h2, 'Position', [.634 .15 .015 .71]);
set(h2,'FontSize',11);
set(h2,'ytick',[log10(0.001) log10(0.01) log10(0.1) log10(1)],...
    'yticklabel',{'0.001' '0.01' '0.1' '1.0'}, 'FontSize',11)
%..........................................................................
set(gca,'FontSize',11,'FontName','Arial');
%==========================================================================
F03 = subplot(1,3,3);
%..........................................................................
hold on
box on
%..........................................................................
pcolor(TIMEr,Zr_N,log10(PAR));
shading interp
%..........................................................................
title('(c) PAR (W m^{-2})')
%..........................................................................
xlim([1 365]);
xlabel('Time (months)')
set(gca,'XTick',Tvec,'XTickLabel',Tout,'FontSize',11)
%..........................................................................
ylim([-250 0]);
% ylabel('Depth (m)');
set(gca,'YTick',[-250:50:0],'YTickLabel',[],'FontSize',11)
%..........................................................................
colormap(jet);
caxis([log10(0.1) log10(120)]);
h3 = colorbar('EastOutside');
set(h3, 'Position', [.955 .15 .015 .71]);
set(h3,'FontSize',11);
set(h3,'ytick',[log10(0.1) log10(1.0) log10(10) log10(100)],...
    'yticklabel',{'0.1' '1.0' '10' '100'}, 'FontSize',11)
%..........................................................................
set(gca,'FontSize',11,'FontName','Arial');
%==========================================================================
% Subplots position: [left edge | bottom edge | fig weight | fig height]
%..........................................................................
set(F01,'position',[0.06 0.14 0.255 0.73])
set(F02,'position',[0.37 0.14 0.255 0.73])
set(F03,'position',[0.69 0.14 0.255 0.73])
%==========================================================================
%% Save figure:
%..........................................................................
set(gcf,'PaperPositionMode','auto');
print(gcf, '-dpng', 'FIG02_PhysicalForcing.png');
%--------------------------------------------------------------------------
print('FIG02_PhysicalForcing', '-depsc'); % Save as an EPS file
%--------------------------------------------------------------------------
% Get the current figure position in inches
fig = gcf;
fig.Units = 'inches';
figPosition = fig.Position;
%..........................................................................
% Set PaperSize to match the figure dimensions
set(gcf, 'PaperUnits', 'inches');
set(gcf, 'PaperSize', [figPosition(3) figPosition(4)]);
%..........................................................................
% Save the figure as a PDF using the print command
print(gcf, 'FIG02_PhysicalForcing.pdf', '-dpdf', '-bestfit');
%==========================================================================
return
